<div class="container">
  <div class="messages" #messagesContainer>
    <div *ngIf="messages()?.length > 0; else noMessages">
      <div class="message" *ngFor="let messageGroup of messages()">
        <div class="avatar">
          <img [src]="messageGroup[0].user.picture">
        </div>
        <div class="msg">
          <div class="msg-user">
            <p class="msg-user-name"><b>{{messageGroup[0].user.name}}</b></p>
            <p class="msg-user-time">{{messageGroup[0].timestamp}}</p>
          </div>

          <div class="msg-text" *ngFor="let message of messageGroup">
            <div class="msg-text-container">
              <markdown class="msg-text-message" [data]="message.message"></markdown>
              <div class="msg-attachments" *ngIf="message.attachments?.length">
                <div class="attachment" *ngFor="let url of message.attachments">
                  <img *ngIf="isImage(url)" [src]="url" class="attachment-img" />
                  <video *ngIf="isVideo(url)" controls [src]="url" class="attachment-video"></video>
                  <a *ngIf="!isImage(url) && !isVideo(url)" [href]="url" target="_blank" class="attachment-file">
                    ðŸ“„ {{ getFileName(url) }}
                  </a>
                </div>
              </div>
              <p *ngIf="message !== messageGroup[0]" class="msg-text-time">{{message.timestamp}}</p>
            </div>
          </div>
        </div>
      </div>
      <div id="last-message"></div>
    </div>
    <ng-template #noMessages>
      <div class="message">
        <div class="msg">
          <div class="msg-text">
            <p class="msg-text-message" style="text-align: center;">No messages to see here... yet!</p>
          </div>
        </div>
      </div>
    </ng-template>
  </div>

  <div class="input">
    <md-editor
      name="Content"
      [(ngModel)]="messageText"
      [height]="'200px'"
      [options]="editorOptions"
      required
      maxlength="500"
    ></md-editor>

    <input type="file" multiple (change)="onFileSelected($event)" hidden #fileInput />
    <div class="attachments-preview" *ngIf="selectedFiles.length > 0">
      <div class="attachment" *ngFor="let file of selectedFiles">
        <img *ngIf="file.type.startsWith('image/')" [src]="file.preview" class="attachment-img" />
        <p *ngIf="!file.type.startsWith('image/')">ðŸ“Ž {{file.name}}</p>
      </div>
    </div>

    <div class="actions">
      <button type="button" (click)="fileInput.click()">ðŸ“Ž</button>
      <button type="button" class="private" (click)="sendMessage()">send</button>
    </div>
  </div>
</div>
